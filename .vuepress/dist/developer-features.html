<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Writing Custom Script | Smartloop</title>
    <meta name="description" content="A Conversational AI Platform to Automate Marketing">
    
    
    <link rel="preload" href="/assets/css/0.styles.26516266.css" as="style"><link rel="preload" href="/assets/js/app.bf228800.js" as="script"><link rel="preload" href="/assets/js/14.7c6ad15e.js" as="script"><link rel="prefetch" href="/assets/js/10.a0fe555e.js"><link rel="prefetch" href="/assets/js/11.6115dbca.js"><link rel="prefetch" href="/assets/js/12.5e440be9.js"><link rel="prefetch" href="/assets/js/13.2dc4b516.js"><link rel="prefetch" href="/assets/js/15.09bd51c0.js"><link rel="prefetch" href="/assets/js/16.9d7fef39.js"><link rel="prefetch" href="/assets/js/17.4f3d6b0e.js"><link rel="prefetch" href="/assets/js/18.7ec0d924.js"><link rel="prefetch" href="/assets/js/19.1712a2fc.js"><link rel="prefetch" href="/assets/js/2.0a2db423.js"><link rel="prefetch" href="/assets/js/20.07d35d86.js"><link rel="prefetch" href="/assets/js/21.b529ef3e.js"><link rel="prefetch" href="/assets/js/3.066f4497.js"><link rel="prefetch" href="/assets/js/4.8acb3661.js"><link rel="prefetch" href="/assets/js/5.b5ba00f4.js"><link rel="prefetch" href="/assets/js/6.eb42ae51.js"><link rel="prefetch" href="/assets/js/7.de943f6d.js"><link rel="prefetch" href="/assets/js/8.8f9ffa22.js"><link rel="prefetch" href="/assets/js/9.ed69e499.js">
    <link rel="stylesheet" href="/assets/css/0.styles.26516266.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Smartloop</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://smartloop.ai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://dashboard.smartloop.ai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dashboard
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://blog.recime.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://smartloop.ai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://dashboard.smartloop.ai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dashboard
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://blog.recime.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/basic-concepts.html" class="sidebar-link">Basic Concepts</a></li><li><a href="/capturing-user-input.html" class="sidebar-link">Capturing User Input</a></li><li><a href="/redirect-using-go-to.html" class="sidebar-link">Redirect using Go-to</a></li><li><a href="/json-api.html" class="sidebar-link">Integrations using JSON API</a></li><li><a href="/how-to-entities.html" class="sidebar-link">How to use Entities?</a></li><li><a href="/sequence.html" class="sidebar-link">Engage Users with Sequence</a></li><li><a href="/broadcasting.html" class="sidebar-link">Broadcasting (Push Notifications)</a></li><li><a href="/configure-website-bot.html" class="sidebar-link">WebChat Module</a></li><li><a href="/working-with-variables.html" class="sidebar-link">User Variables</a></li><li><a href="/collecting-user-data.html" class="sidebar-link">Collecting User Data</a></li><li><a href="/developer-features.html" class="active sidebar-link">Writing Custom Script</a></li><li><a href="/capabilities.html" class="sidebar-link">Capabilities</a></li><li><a href="/resources.html" class="sidebar-link">Resources</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="writing-custom-script"><a href="#writing-custom-script" aria-hidden="true" class="header-anchor">#</a> Writing Custom Script</h1> <p>Script Block allows you to quickly write custom logic inside a conversation flow. Click on <code>script</code> button in the toolbar as shown below to insert a script block:</p> <p><img src="/assets/img/script-block.d79afc33.png" alt></p> <p>The entire conversation context is available in the script block. This will let you write custom logic based on user input, entities and variables. The example below shows how to pull data from a weather API and then set it as a context variable for use in the builder:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//script block</span>
<span class="token comment">//https://docs.recime.io/script-block.html</span>
<span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'request'</span><span class="token punctuation">;</span>

<span class="token comment">// get a free API key from openweathermap.org</span>
<span class="token keyword">const</span> appId <span class="token operator">=</span> <span class="token string">'PASTE_YOUR_API_KEY'</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url <span class="token punctuation">:</span> <span class="token string">'https://api.openweathermap.org/data/2.5/weather'</span><span class="token punctuation">,</span>
        qs <span class="token punctuation">:</span> <span class="token punctuation">{</span>
            lat <span class="token punctuation">:</span> context<span class="token punctuation">.</span>nlp<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>location<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lat<span class="token punctuation">,</span>
            lon <span class="token punctuation">:</span> context<span class="token punctuation">.</span>nlp<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>location<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lng<span class="token punctuation">,</span>
            appid<span class="token punctuation">:</span> appId<span class="token punctuation">,</span>
            units<span class="token punctuation">:</span> <span class="token string">'imperial'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        json <span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> reponse<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//debug</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
     
        <span class="token comment">// save </span>
        context<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;weatherData&quot;</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p><code>context</code> parameter have the following properties:</p> <table><thead><tr><th>Property Name</th> <th>Description</th></tr></thead> <tbody><tr><td>args</td> <td>[User input]</td></tr> <tr><td>nlp</td> <td>Contains entities and intents for an expression.</td></tr> <tr><td>vars</td> <td>Set or get vars to use in the current context.</td></tr></tbody></table> <p>The <code>args</code> object contains the following properties:</p> <table><thead><tr><th>Property Name</th> <th>Description</th> <th>Type</th></tr></thead> <tbody><tr><td>sender</td> <td>Unique sender ID</td> <td>String</td></tr> <tr><td>text</td> <td>Input text.(e.g. Where is San Francisco?)</td> <td>String</td></tr> <tr><td>event</td> <td>Event to trigger an intent. Either text or event is required.</td> <td>Object</td></tr></tbody></table> <p><code>event</code> contains the name of the event that is triggered for a user action:</p> <table><thead><tr><th>Property Name</th> <th>Description</th> <th>Type</th></tr></thead> <tbody><tr><td>name</td> <td>Name of the event (e.g. start) that corresponds to an intent name</td> <td>String</td></tr></tbody></table> <p>You can use variables inside the builder in the following way using the double braces syntax:</p> <p><img src="/assets/img/context-vars.b1caf032.png" alt></p> <p>You can also output in script block using the <a href="https://github.com/Recime/recime-bot-extension" target="_blank" rel="noopener noreferrer">extension module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in the following way:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Ext <span class="token keyword">from</span> <span class="token string">&quot;recime-bot-extension&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> __ <span class="token operator">=</span> Ext<span class="token punctuation">.</span>default<span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span>__<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Script block can be useful in the following scnearios:</p> <ul><li>Retrieving data from your existing API that you want inject in your conversation context.</li> <li>Construct dynamic response based on user input and entities.</li></ul> <p>The following modules are allowed inside <strong>Script Block</strong>:</p> <ul><li><a href="https://nodejs.org/api/modules.html#modules_core_modules" target="_blank" rel="noopener noreferrer">node core<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/request/request" target="_blank" rel="noopener noreferrer">request<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://momentjs.com/" target="_blank" rel="noopener noreferrer">moment.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Recime/recime-bot-extension" target="_blank" rel="noopener noreferrer">Bot Extension<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/24/2019, 3:55:28 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/collecting-user-data.html" class="prev">
          Collecting User Data
        </a></span> <span class="next"><a href="/capabilities.html">
          Capabilities
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.bf228800.js" defer></script><script src="/assets/js/14.7c6ad15e.js" defer></script>
  </body>
</html>
